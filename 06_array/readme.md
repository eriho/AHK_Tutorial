# AHKでいろいろやってみよう(その3)

## 本記事で学べること

今回は配列について書きたいと思います。配列とは、複数の値をまとめて扱うことのできる箱のようなもので、その箱から一つずつ順番に値を取り出すことができ、配列の中身を一つずつ順番に取り出しながら繰り返し処理を実行する`for`ループと相性がいいですので、一緒に説明します。また、AHKが自動で用意してくれる便利な変数である組み込み変数も説明します。

* 配列の定義の仕方
* 配列を活用した`for`による繰り返し
* 組み込み変数について

## 配列の定義の仕方

まず変数についてを思い出して下さい。変数は値を格納する名前のついた箱のことでした。

```AutoHotkey::

myFolder := "20_Jan"

```

このように変数が保持する値は1つですが、配列は**複数の値を格納する**ことができます。

```AutoHotkey::

myFolders := Object()
myFolders := ["20_Jan","19_Dec","19_Nov"]
```

配列の名前は`myFolders`としています。変数と違うのは、

* 配列を作成する時に`配列名:=Object()`と宣言を行うこと
* 配列の中身を入れる時に`[x,y,z]`のように鉤括弧で囲み、カンマで区切って複数の値を代入している

ことです。

## 配列の使い方の例

今回のAHKでは、3つのフォルダにある同じ名前のあるファイルがあり、そのファイルを順番に自動でメモ帳で開く処理を記載したいと思います。

### フォルダ構成

まず、以下のようなフォルダ構成を想定します。今いるフォルダを`code`とし、その下に3つのフォルダがあり、それぞれにres.csvというファイルが格納されています。ahkのコードは`code`の直下に存在するarrayFor.ahkです。

```
code/
 ┣20_Jan
 ┃ └ res.csv
 ┣19_Dec
 ┃ └ res.csv
 ┣20_Jan
 ┃ └ res.csv
 ┗ arrayFor.ahk
```

### 配列とforを使ってみよう

さてここでまず、配列に3つのフォルダ名を入れて、その配列を順番に表示させてみましょう。

```AutoHotkey::

myFolders := Object()

myFolders := ["20_Jan","19_Dec","19_Nov"]

for index, myFolder in myFolders
{
	MsgBox , ループ%index%回目、フォルダ:  %myFolder% を開きます
	
}

```

このコードで`for`に注目して下さい。`for`は、配列(`myFolders`)からフォルダ名を一つずつ取り出して**変数myFolderに入れて**います。また同時に、`index`という変数に、現在何回目のループかを示す数値を自動で入力します(ループの回数は1始まりです)。

`Msgbox`は引数をメッセージボックスに表示させる命令です。`%myFolder%`の値がループの度に`20_Jan`→`19_Dec`→`19_Nov`と変更されて表示されます。この時ループの繰り返し回数を示す数字は1→2→3と変更されます。

forの使い方をまとめると以下のようになります。
```
for ループ回数を入れる変数, 配列を入れる変数 in 配列
  {
    処理
  }
```

このように、配列と一緒に`for`を用いることで、処理内容は一緒だが一部分だけを変更して処理を行いたい、という時に便利な使い方になります。

## 組み込み変数と起動用命令run

ここまででフォルダを繰り返し毎に変更することができるようになりました。次は、読み込むファイルのフォルダを変更しながらメモ帳で順番に開く、ということをやってみましょう。

```

myFolders := Object()

myFolders := ["20_Jan","19_Dec","19_Nov"]
thisFileName := "res.csv"

for index, myFolder in myFolders
{
  Run, notepad.exe %A_ScriptDir%\%myFolder%\%thisFileName%
}

return
```

まず、`run, 起動させたい実行ファイル名`でwindowsの任意のコマンドを実行することができます。`notepad.exe`はメモ帳のコマンド名です。`excel.exe`ならばエクセルが起動します。注意点としては、パスが通っていればコマンド名だけで指定できますが、通っていない場合は場所を明示してコマンドを指定する必要があることです。

実行ファイル名の後には、その実行ファイルの引数を記載します。ここで`%`に囲まれた文字は変数を示しています。`%myFolder%`と`%thisFileName%`はこれまでに登場した変数ですが、`%A_ScriptDir%`は何を指すのでしょうか？少なくとも自分では定義していません。

`%A_ScriptDir%`のように、Aから始まる変数は**組み込み変数**と呼ばれ、AHKが自動で用意してくれる便利な変数です。`A_ScriptDir`はスクリプトのあるディレクトリパスを格納しています。
この組み込み変数を使うと、自分でスクリプトのある場所を書き写す手間から解放されるだけでなく、フォルダをコピーして他の人に渡したりする時でも動くというメリットがあります。例えば自分は`c:\myProgram\`の直下にこのフォルダを置いていたとしても、他の人は`d:\programming`に置きたいかもしれません。このような場合でも問題なく動作します。

他にもAHKが用意している組み込み変数は多数あります。一覧は[こちら](http://ahkwiki.net/Variables)を参照して下さい。使えそうなものを頭の片隅に入れておくといいと思います。



